# 集群与分布式

在说集群与分布式之前我们先说单机结构，单机结构我们很熟悉，就是把**所有的代码都放在一个项目中**，然后**将这个项目部署在一个服务器上**。

但与此同时，单机结构的缺点也是显而易见的，一台服务器处理所有的服务请求，当业务量增长到一定程度，单机的硬件资源将无法满足你的业务需求，为了解决这个问题，于是就有了集群的概念。

## 集群

所谓集群，就是由原本的单个服务器，复制多份。我们将这些所有的单机总称为**集群**，而集群中的每台单机服务器，我们叫做**节点**。在集群中，每个节点都提供相同的一模一样的服务，显而易见，这个系统的处理能力相比于之前的单机结构提升了N倍(N为节点个数)。

也就是说，原来的单机结构，所有的用户请求，都在同一个服务器上执行。现在有了集群，每个单独的节点都可以做业务操作，此时不同的用户请求，往往会分配到不同的节点服务器上。

那么问题来了，谁来控制或者说将用户的请求分配到某个具体的节点上呢？这个东西叫**负载均衡服务器**，他接收所有的用户请求，然后根据所有节点的负载情况来决定将当前请求交给哪个节点。	

举个现实中的例子：

> 你入职了一家公司做开发，公司规模一开始比较小，所以公司目前只有你一个研发，所有的开发业务都是你来做，这种情况就叫做**单机结构**。
>
> 后来公司规模越来越大，要处理的业务量也越来越多，你一个人已经无法应付过来，这时候公司就招人，又招了4个人，此时你们开发团队就有了5个人。这时你们5个人就形成了一个**集群**，每个人都是集群的**节点**，为了管理好你们5个开发人员的工作量，你们的团队就需要一个队长，这个队长接收公司下发的任务，再分配给你们，这时候这个队长就是我们刚才说的**负载均衡器**。现在的系统由单机：
>
> > 公司 -> 你
>
> 改为了
>
> > 公司->你的队长->你(或你的同事)
>
> 你的队长会视你们每个人手头现有的任务量，来决定当有新的任务到来时，需要把这个任务分配给你们谁。(手头任务量最少的那个)。

上面就是一个单机向集群的演化过程。

**集群的好处：**

* 1. 相比于单机结构，相率得到了大大的提升
  2. 当一台服务器出现问题时，项目不会死掉，还有其他服务器可以顶上。

但问题又来了

你们公司的开发项目，一个项目既需要前端又需要后端。我们刚才说了，集群中的每个节点，做的工作都是相同的，都需要独立的完成一个业务操作。但当把一个完整的项目交给一个人时，这个人往往可能只会前端或只会后端，他无法做到精通全栈。这种情况要怎么解决呢？这里我们就引入了分布式与微服务的概念。

## 分布式

从单机结构到集群结构，你的代码本身无需做任何修改，只需要多配置几台服务器，每台服务器都运行相同的代码就行了。但当你从集群结构演进到微服务，**之前的代码就需要进行很大的变动**。

> 分布式系统是将一个完整的系统，按照业务功能，拆分成单个独立的子系统，这里每一个子系统我们称之为服务(微服务),每个子系统独立运行在Web中，他们之间通过RPC通信。

再继续刚才的例子比喻分布式：

> 你们公司的规模已经很大了，为了解决增加的业务处理需求，公司新招了很多开发人员，这样每个人员都负责一个完整的项目，开发的效率也就比以前提高了N倍(N为开发人员数量)。但并不是每个开发人员都具有独立开发一个项目的能力，有些人擅长前端，有些人擅长后端，有些人擅长测试，还有些人擅长定方案。
>
> 于是我们将原来的一个完整的项目拆分，拆成前端、后端、测试等若干份(每一份就是我们上面说的服务)。这样我公司再招人扩充的时候，就可以看看到底是哪个环节的人员不够，专门对那个环节的人员进行扩充(比如前端5个人够了，但后端5个人不够，于是公司可以针对后端，再招5个后端的开发。)

一个完整的项目被拆分成若干子系统(服务)，每个服务单独部署在一台服务器上，哪个服务的访问次数或业务处理量比较多，服务器的压力比较大，我就针对这个服务，再多扩充几个。

拿淘宝举例子，一个完整的淘宝系统可以分为

* 用户服务
* 商品服务
* 订单服务
* 促销服务
* 数据分析服务

![img](https://pic3.zhimg.com/80/v2-0882bc64f3f20939876d3433e51fad72_720w.jpg)

每个服务单独部署在一台服务器上，但有些服务的业务量可能比较大，比如商品服务的业务量一般大于促销服务，此时我们可以用一台服务器部署订单服务，但用5台服务器，每台都部署一个商品服务(**分布式集群**)。



**分布式的好处**

* 1. 系统之间的耦合度大大降低，可以独立开发、独立部署、独立测试，系统与系统之间的边界非常明确，排错也变得相当容易，开发效率大大提升。

* 2. 系统之间的耦合度降低，从而系统更易于扩展。我们可以针对性地扩展某些服务。假设这个商城要搞一次大促，下单量可能会大大提升，因此我们可以针对性地提升订单系统、产品系统的节点数量，而对于后台管理系统、数据分析系统而言，节点数量维持原有水平即可。

* 3. 服务的复用性更高。比如，当我们将用户系统作为单独的服务后，该公司所有的产品都可以使用该系统作为用户系统，无需重复开发。